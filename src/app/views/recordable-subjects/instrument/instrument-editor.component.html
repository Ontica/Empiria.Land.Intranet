<form [formGroup]="formHandler.form" [empNgSpinnerHost]="spinner" empNgFormKeyDownEnter
  autocomplete="off" class="form-section">

  <emp-ng-spinner #spinner [visible]="isLoading"></emp-ng-spinner>

  <div fxLayout="column" fxLayout.lt-md="column" fxLayoutGap="0.75rem" fxLayoutGap.lt-md="0">
    <div class="section-title" *ngIf="title">{{ title }}</div>

    <div fxLayout="row" fxLayout.lt-md="column">
      <div [fxFlex]="100/3">
        <label>Tipo de instrumento:</label>
        <emp-ng-select [formControlName]="controls.type"
          [bindLabel]="'typeName'"
          [bindValue]="'type'"
          [items]="instrumentTypesList"
          [showError]="formHandler.showInvalidControl(controls.type)"
          (changes)="onInstrumentTypeChange($event)">
        </emp-ng-select>

      </div>

      <ng-container *ngIf="!validateTypeSelected([InstrumentType.Resumen])">
        <div [fxFlex]="100/3">
          <label>Fecha:</label>
          <emp-ng-datepicker [formControlName]="controls.issueDate">

          </emp-ng-datepicker>
        </div>

        <div [fxFlex]="100/3" fxLayoutAlign="end">
          <div fxFlex="100px">
            <label>Número de hojas:</label>
            <input [formControlName]="controls.sheetsCount" type="number" class="text-box"
              [class.invalid-control]="formHandler.showInvalidControl(controls.sheetsCount)">
          </div>
        </div>
      </ng-container>

    </div>

    <ng-container *ngIf="typeSelected">
      <div fxLayout="row" fxLayout.lt-md="column" *ngIf="!validateTypeSelected([InstrumentType.Resumen])">
        <div fxFlex="100">
          <ng-container [ngSwitch]="typeSelected">
            <label *ngSwitchCase="InstrumentType.DocumentoJuzgado">Autoridad:</label>
            <label *ngSwitchCase="InstrumentType.DocumentoTerceros">Expedido por:</label>
            <label *ngSwitchCase="InstrumentType.TituloPropiedad">Expedido por C.:</label>
            <label *ngSwitchDefault>Notaría:</label>
          </ng-container>
          <emp-ng-select [formControlName]="controls.issuer"
            [config]="{ clearable: true, hideSelected: true, minTermLength: issuerMinTermLength }"
            [items]="issuerList$ | async"
            [typeahead]="issuerInput$"
            [loading]="issuerLoading">
          <ng-template #labelTemplate let-item="item">
            <ng-container *ngIf="validateTypeSelected([InstrumentType.EscrituraPublica,
                                                       InstrumentType.OficioNotaria])">
              <span class="ng-value-label">
                <strong>{{item.entity}}, {{item.place}} - </strong>
                {{item.officialPosition}} - {{item.name}}
              </span>
            </ng-container>

            <ng-container *ngIf="validateTypeSelected([InstrumentType.DocumentoJuzgado])">
              <span class="ng-value-label">
                <strong>{{item.place}} - </strong>
                {{item.officialPosition}} - {{item.name}}
              </span>
            </ng-container>

            <ng-container *ngIf="validateTypeSelected([InstrumentType.DocumentoTerceros,
                                                       InstrumentType.TituloPropiedad])">
              <span class="ng-value-label">
                <strong>{{item.name}} - </strong>
                {{item.officialPosition}}
              </span>
            </ng-container>
          </ng-template>

          <ng-template #optionTemplate let-item="item">
            <ng-container *ngIf="validateTypeSelected([InstrumentType.EscrituraPublica,
                                                       InstrumentType.OficioNotaria])">
              <div class="ng-option item-template">
                {{item.entity}}, {{item.place}}<br>
                <span class="item-text-sm">
                  <strong>{{item.officialPosition}}</strong>
                  {{item.name}}
                </span>
              </div>
            </ng-container>

            <ng-container *ngIf="validateTypeSelected([InstrumentType.DocumentoJuzgado])">
              <div class="ng-option item-template">
                <strong>{{item.place}},</strong> {{item.officialPosition}}<br>
                {{item.name}}
              </div>
            </ng-container>

            <ng-container *ngIf="validateTypeSelected([InstrumentType.DocumentoTerceros,
                                                       InstrumentType.TituloPropiedad])">
              <div class="ng-option item-template">
                <strong>{{item.name}}</strong> <br>
                {{item.officialPosition}}
              </div>
            </ng-container>
          </ng-template>
        </emp-ng-select>
        </div>
      </div>

      <div fxLayout="row" fxLayout.lt-md="column">
        <div [fxFlex]="100/3" fxFlex.lt-md="100"
          *ngIf="validateTypeSelected([InstrumentType.OficioNotaria,
                                       InstrumentType.DocumentoJuzgado,
                                       InstrumentType.DocumentoTerceros,
                                       InstrumentType.Resumen])">

          <ng-container [ngSwitch]="typeSelected">
            <label *ngSwitchCase="InstrumentType.DocumentoTerceros">Tipo de documento:</label>
            <label *ngSwitchCase="InstrumentType.Resumen">Tipo de documento:</label>
            <label *ngSwitchDefault>Tipo de oficio:</label>
          </ng-container>

          <emp-ng-select [formControlName]="controls.kind"
            [items]="instrumentKindsList"
            [config]="{clearable: true}"
            [bindValue]="'name'"
            [showError]="formHandler.showInvalidControl(controls.kind)">
          </emp-ng-select>
        </div>

        <div [fxFlex]="100/3" fxFlex.lt-md="100" *ngIf="!validateTypeSelected([InstrumentType.Resumen])">

          <ng-container [ngSwitch]="typeSelected">
            <label *ngSwitchCase="InstrumentType.EscrituraPublica">Escritura:</label>
            <label *ngSwitchCase="InstrumentType.OficioNotaria">No. Oficio:</label>
            <label *ngSwitchCase="InstrumentType.DocumentoJuzgado">Oficio:</label>
            <label *ngSwitchCase="InstrumentType.DocumentoTerceros">No. Documento:</label>
            <label *ngSwitchCase="InstrumentType.TituloPropiedad">Título de propiedad No.:</label>
          </ng-container>

          <input [formControlName]="controls.instrumentNo"
            type="text"
            class="text-box uppercase">
        </div>

        <div [fxFlex]="100/3" fxFlex.lt-md="100"
          *ngIf="validateTypeSelected([InstrumentType.EscrituraPublica,
                                       InstrumentType.DocumentoJuzgado])">
          <ng-container [ngSwitch]="typeSelected">
            <label *ngSwitchCase="InstrumentType.EscrituraPublica">Volumen / libro:</label>
            <label *ngSwitchDefault>Expediente:</label>
          </ng-container>
          <input [formControlName]="controls.binderNo"
            type="text"
            class="text-box uppercase">
        </div>

        <div [fxFlex]="100/3" fxFlex.lt-md="100" fxLayoutAlign="end"
          *ngIf="validateTypeSelected([InstrumentType.EscrituraPublica])">
          <div fxFlex="100px">
            <label>Folio del:</label>
            <input [formControlName]="controls.folio"
              type="text"
              class="text-box uppercase"
              style="width: 90px;">
            </div>

            <div fxFlex="100px">
              <label>al:</label>
              <input [formControlName]="controls.endFolio"
                type="text"
                class="text-box uppercase"
                style="width: 90px;">
            </div>
        </div>

        <div [fxFlex]="100/3" fxFlex.lt-md="100"
          *ngIf="validateTypeSelected([InstrumentType.TituloPropiedad])">
            <label>Folio:</label>
            <input [formControlName]="controls.folio"
              type="text"
              class="text-box uppercase">
        </div>
      </div>
    </ng-container>

    <div fxLayout="row" fxLayout.lt-md="column">
      <div fxFlex>
        <label>Descripción del instrumento:</label>
        <emp-ng-text-editor [formControlName]="controls.summary">
        </emp-ng-text-editor>
      </div>
    </div>

    <mat-divider *ngIf="actions.can.editInstrument || actions.show.registrationStamps || addMode"
      class="divider-padding" >

    </mat-divider>

    <div fxLayout="row">

      <div [fxFlex]="100/3" fxLayoutAlign="start">

        <button *ngIf="actions.can.editInstrument && !addMode"
          (click)="enableEditor(!editionMode)"
          [ngClass]="editionMode ? 'btn' : 'btn-action'">
          {{editionMode ? 'Descartar Cambios' : 'Editar Documento'}}
        </button>

      </div>

      <div [fxFlex]="100/3" fxLayoutAlign="center center" *ngIf="showStatusField && editionMode">

          <span class="pr-1">Marcar la inscripción como:</span>

          <emp-ng-select
            [formControlName]="controls.status"
            [items]="statusList"
            [showError]="formHandler.showInvalidControl(controls.status)">
          </emp-ng-select>

      </div>

      <div fxFlex fxLayoutAlign="end">

        <button *ngIf="editionMode && ( actions.can.editInstrument || addMode )"
          (click)="submit()"
          class="btn-action">
          {{ submitButtonText }}
        </button>

        <ng-container *ngIf="!editionMode">

          <button *ngIf="actions.can.openInstrument"
            (click)="openRegistration()"
            class="btn-action">
            Abrir registro
          </button>

          <button *ngIf="actions.can.closeInstrument"
            (click)="closeRegistration()"
            class="btn-action">
            Cerrar registro
          </button>


          <button *ngIf="actions.show.registrationStamps"
            (click)="submitPrintRegistrationStampMedia()"
            class="btn-action">
            Imprimir sello interesado
          </button>

        </ng-container>

      </div>

    </div>
  </div>
</form>
